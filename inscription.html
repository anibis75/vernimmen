<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Argos | Accès sécurisé</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
<style>
:root{
  --bg1:#0b0f14; --bg2:#101626; --fg:#eef3f9; --muted:#9fb0c5;
  --accent:#e63946; --accent2:#2ec4b6; --glass:rgba(255,255,255,.06);
  --glass-border:rgba(255,255,255,.15);
  --shadow:0 10px 30px rgba(0,0,0,.35), inset 0 1px 0 rgba(255,255,255,.05);
  --radius:22px; --auth-w:360px; --plans-gap:26px; --plan-top-h:130px;
  --container: min(1600px, 96vw);
}
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0; font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,"Helvetica Neue",sans-serif; color:var(--fg);
  background: linear-gradient(135deg,var(--bg1),var(--bg2));
}
header{padding:44px 24px 18px;text-align:center}
.header-inner{max-width:var(--container);margin:0 auto}
.brand{display:inline-flex;align-items:center;gap:14px;color:inherit;text-decoration:none}
.brand img{height:96px;width:auto;filter:drop-shadow(0 8px 16px rgba(0,0,0,.2))}
.brand h1{margin:0;font-weight:800;font-size:clamp(28px,3.2vw,42px)}
.sub{margin:8px 0 0;color:var(--muted)}
main{max-width:var(--container);margin:10px auto 70px;padding:0 24px}
.layout{display:grid;gap:34px;grid-template-columns:var(--auth-w) 1fr}
@media (max-width:1200px){.layout{grid-template-columns:1fr}}
.card{
  background:linear-gradient(160deg, rgba(255,255,255,.085), rgba(255,255,255,.02));
  border:1px solid var(--glass-border); border-radius:var(--radius);
  box-shadow:var(--shadow); color:var(--fg);
}
/* Auth */
.auth{padding:24px}
.switch{display:flex;gap:10px;background:rgba(255,255,255,.06);border:1px solid var(--glass-border);border-radius:999px;padding:6px;margin-bottom:14px}
.switch button{flex:1;border:none;background:transparent;color:var(--muted);padding:10px;border-radius:999px;font-weight:700;cursor:pointer}
.switch button.active{background:rgba(255,255,255,.15);color:var(--fg)}
.input{width:100%;padding:14px 16px;margin:8px 0;border-radius:12px;border:1px solid var(--glass-border);background:rgba(255,255,255,.05);color:var(--fg)}
.btn{width:100%;padding:14px;border-radius:12px;font-weight:800;cursor:pointer;border:none}
.btn.primary{background:linear-gradient(135deg, rgba(46,196,182,.6), rgba(255,255,255,.08));color:var(--fg)}
.btn.danger{background:linear-gradient(135deg, rgba(230,57,70,.6), rgba(255,255,255,.08));color:var(--fg);margin-top:8px}
.helper{color:var(--muted);font-size:14px;margin-top:10px}
.msg{display:none;margin-top:10px;padding:10px 12px;border-radius:10px;font-size:14px}
.msg.error{display:block;background:rgba(230,57,70,.15);border:1px solid rgba(230,57,70,.5);color:#fecaca}
.msg.ok{display:block;background:rgba(46,196,182,.15);border:1px solid rgba(46,196,182,.5);color:#d1fae5}
/* Plans */
.plans-wrap{padding:24px}
.plans-title{margin:0 0 14px;font-weight:800;font-size:22px}
.plans{display:grid;gap:var(--plans-gap);grid-template-columns:repeat(4,1fr)}
@media (max-width:1400px){.layout{grid-template-columns:1fr}.plans{grid-template-columns:repeat(2,1fr)}}
@media (max-width:800px){.plans{grid-template-columns:1fr}}
.plan{
  position:relative;display:flex;flex-direction:column;padding:20px;transition:.18s ease;outline:2px solid transparent;border-radius:18px;
  background:linear-gradient(160deg, rgba(255,255,255,.07), rgba(255,255,255,.02));
}
.plan::before{
  content:""; position:absolute; inset:-1px; border-radius:inherit; pointer-events:none;
  background:
    conic-gradient(from 0deg, rgba(46,196,182,.0), rgba(46,196,182,.45), rgba(46,196,182,.0) 70%),
    radial-gradient(140% 140% at 50% 0%, rgba(46,196,182,.25), rgba(46,196,182,0) 60%);
  filter: blur(10px); opacity:.9;
  -webkit-mask: linear-gradient(#000,#000) content-box, linear-gradient(#000,#000);
  -webkit-mask-composite: xor; mask-composite: exclude;
  padding:2px;
}
.plan:hover{transform:translateY(-3px);box-shadow:0 14px 42px rgba(0,0,0,.45)}
.plan.selected{outline-color:var(--accent2)}
.plan .top{display:flex;flex-direction:column;align-items:center;text-align:center;min-height:var(--plan-top-h);justify-content:flex-start;gap:6px}
.plan .name{font-weight:900;font-size:20px}
.plan .price{font-weight:900;font-size:22px}
.plan .per{font-size:12px;color:var(--muted)}
.badge{display:inline-flex;align-items:center;gap:8px;padding:8px 12px;background:rgba(255,255,255,.08);border:1px solid var(--glass-border);border-radius:999px;font-weight:700;font-size:14px}
.badge .dot{width:10px;height:10px;border-radius:50%;background:var(--accent2)}
.plan ul{list-style:disc;padding-left:20px;margin:12px 0 0 0;flex-grow:1}
.plan li{margin:8px 0}
.plan .bottom{margin-top:16px;display:flex;justify-content:center}
.plan .cta{border:1px solid var(--glass-border);background:rgba(255,255,255,.06);padding:10px 14px;border-radius:12px;font-weight:700;cursor:pointer}
.plan .cta:hover{box-shadow:0 10px 28px rgba(0,0,0,.35)}
footer{color:var(--muted);text-align:center;padding: 18px 24px 44px;font-size:14px}
</style>
</head>
<body>
<header>
  <div class="header-inner">
    <a href="#" class="brand" aria-label="Accueil Argos">
      <img src="https://anibis75.github.io/vernimmen/logo.png" alt="Argos" />
      <h1>Argos — Accès sécurisé</h1>
    </a>
    <p class="sub">Créez un compte ou connectez-vous, puis choisissez votre plan.</p>
  </div>
</header>

<main class="layout">
  <!-- Auth -->
  <section class="card auth" aria-labelledby="auth-title">
    <h2 id="auth-title" style="margin:0 0 10px;font-size:22px;font-weight:800">Authentification</h2>
    <div class="switch" role="tablist">
      <button id="switch-signin" class="active">Se connecter</button>
      <button id="switch-signup">Créer un compte</button>
    </div>
    <input id="email" class="input" type="email" placeholder="Email" autocomplete="email" />
    <input id="password" class="input" type="password" placeholder="Mot de passe" autocomplete="current-password" />
    <input id="password2" class="input" type="password" placeholder="Confirmer le mot de passe" autocomplete="new-password" style="display:none" />

    <!-- Champ Entreprise (UNIQUE) -->
    <div id="grp-entreprise" style="display:none; margin-top:8px;">
      <label for="entreprise" style="display:block;margin-bottom:6px;">Entreprise (optionnel)</label>
      <input id="entreprise" class="input" type="text" placeholder="Votre entreprise" autocomplete="organization" />
    </div>

    <button id="btn-auth" class="btn primary">Se connecter</button>
    <div id="auth-msg" class="msg"></div>
    <button id="btn-logout" class="btn danger" style="display:none">Se déconnecter</button>
    <div class="helper">Astuce : cliquez un plan à droite pour le sélectionner.</div>
  </section>

  <!-- Plans -->
  <section class="card plans-wrap" aria-labelledby="plans-title">
    <h2 id="plans-title" class="plans-title">Choix du plan</h2>
    <div class="plans" id="plans">
      <article class="plan" data-plan="FREE" tabindex="0">
        <div class="top">
          <div class="name">FREE</div>
          <div class="price">0 € <span class="per">/AN</span></div>
          <div class="badge"><span class="dot"></span> Idéal pour tester</div>
        </div>
        <ul>
          <li>Accès limité à la base de données</li>
          <li>Aperçu général</li>
          <li>Scan restreint sur votre secteur</li>
          <li>Dashboard</li>
          <li>Export PDF simple</li>
        </ul>
        <div class="bottom"><button class="cta" data-choose="FREE">Choisir FREE</button></div>
      </article>

      <article class="plan" data-plan="Vision" tabindex="0">
        <div class="top">
          <div class="name">Vision</div>
          <div class="price">€ 5 000 <span class="per">/AN</span></div>
          <div class="badge"><span class="dot"></span> Analyse sectorielle</div>
        </div>
        <ul>
          <li>Accès sélectif à 1 000 sociétés cotées</li>
          <li>Suivi des indicateurs financiers essentiels</li>
          <li><strong>Analyses de valorisation : multiples & DCF simplifié</strong></li>
          <li>Accès général aux données macro (OAT, RM, inflation, FX)</li>
          <li>Export PDF & PowerPoint</li>
        </ul>
        <div class="bottom"><button class="cta" data-choose="Vision">Choisir Vision</button></div>
      </article>

      <article class="plan" data-plan="Sentinel" tabindex="0">
        <div class="top">
          <div class="name">Sentinel</div>
          <div class="price">€ 15 000 <span class="per">/AN</span></div>
          <div class="badge"><span class="dot"></span> Surveillance continue</div>
        </div>
        <ul>
          <li>Accès à +40 000 sociétés cotées</li>
          <li>Historique & prévisionnel des multiples</li>
          <li>Analyses macro détaillées</li>
          <li>Valorisation avancée (DCF, multiples, DDM)</li>
          <li>Rapports automatisés trimestriels</li>
          <li>Exports PPT, Excel, PDF illimités</li>
        </ul>
        <div class="bottom"><button class="cta" data-choose="Sentinel">Choisir Sentinel</button></div>
      </article>

      <article class="plan" data-plan="Horizon" tabindex="0">
        <div class="top">
          <div class="name">Horizon</div>
          <div class="price">SUR MESURE</div>
          <div class="badge"><span class="dot"></span> Multi-entreprises</div>
        </div>
        <ul>
          <li>Toutes les fonctionnalités de Sentinel</li>
          <li>Suivi multi-portefeuille illimité</li>
          <li>Analyses comparées & tendances</li>
          <li>Historique & prévisionnel des multiples</li>
          <li>Accès complet macros & secteurs</li>
          <li>Projections scénarios multi-entités</li>
          <li>Exports PPT, Excel, PDF consolidés</li>
        </ul>
        <div class="bottom"><button class="cta" data-choose="Horizon">Choisir Horizon</button></div>
      </article>
    </div>
  </section>
</main>

<footer>© <span id="year"></span> Argos</footer>

<!-- Supabase -->
<script src="https://unpkg.com/@supabase/supabase-js@2.45.4/dist/umd/supabase.js"></script>
<script>
/* ====== CONFIG (remplace en prod via injection serveur) ====== */
const SUPABASE_URL = "https://dzvpohuqsmtuhlubjgof.supabase.co";
const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImR6dnBvaHVxc210dWhsdWJqZ29mIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU5NzU5MDYsImV4cCI6MjA3MTU1MTkwNn0.N1J5EsrlYNU-tFX0a8YxoZquFKwbM8IWzx1-UH4GUWI";
const client = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
const APP_URL = "http://127.0.0.1:8501";

/* ====== Utils UI ====== */
document.getElementById('year').textContent = new Date().getFullYear();
const msg = document.getElementById('auth-msg');
function showError(t){ msg.className='msg error'; msg.textContent=t; msg.style.display='block'; }
function showOk(t){ msg.className='msg ok'; msg.textContent=t; msg.style.display='block'; }
function clearMsg(){ msg.className='msg'; msg.textContent=''; msg.style.display='none'; }
function isValidEmail(x){ return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(x); }
async function lock(btn, fn){
  const lbl=btn.textContent; btn.disabled=true; btn.textContent='Patientez…';
  try{ await fn(); } finally{ btn.disabled=false; btn.textContent=lbl; }
}

/* ====== Auth mode ====== */
let mode='signin';
const swIn = document.getElementById('switch-signin');
const swUp = document.getElementById('switch-signup');
const btnAuth = document.getElementById('btn-auth');
const pass2 = document.getElementById('password2');
const grpEnt = document.getElementById('grp-entreprise');

swIn.onclick = () => {
  mode='signin';
  swIn.classList.add('active'); swUp.classList.remove('active');
  btnAuth.textContent='Se connecter';
  pass2.style.display='none';
  grpEnt.style.display='none';
  clearMsg();
};

swUp.onclick = () => {
  mode='signup';
  swUp.classList.add('active'); swIn.classList.remove('active');
  btnAuth.textContent='Créer un compte';
  pass2.style.display='block';
  grpEnt.style.display='block';
  clearMsg();
};

/* ====== Plans ====== */
const cards=[...document.querySelectorAll('.plan')];
function select(planName){
  cards.forEach(c=>c.classList.toggle('selected', c.dataset.plan===planName));
  localStorage.setItem('plan', planName);
}
cards.forEach(c=>{
  c.addEventListener('click', e=>{
    const t=e.target.closest('[data-choose]');
    const name=t ? t.dataset.choose : c.dataset.plan;
    select(name); clearMsg();
  });
});
function selectedPlan(){ const s=document.querySelector('.plan.selected'); return s ? s.dataset.plan : null; }

/* Pré-sélection du plan sauvegardé */
document.addEventListener('DOMContentLoaded', ()=>{
  const saved = localStorage.getItem('plan');
  if (saved) {
    const el = document.querySelector(`.plan[data-plan="${saved}"]`);
    if (el) el.click();
  }
});

/* Entrée = valider */
['email','password','password2'].forEach(id=>{
  const el=document.getElementById(id);
  if(el) el.addEventListener('keydown', e=>{ if(e.key==='Enter') btnAuth.click(); });
});

/* ====== Flows ====== */
async function doSignIn(email, password){
  const { error } = await client.auth.signInWithPassword({ email, password });
  if(error){ showError('Identifiants invalides : '+error.message); return; }
  const plan = localStorage.getItem('plan') || 'FREE';
  await client.auth.updateUser({ data:{ plan } });
  const { data:{ session } } = await client.auth.getSession();
  if(!session){ showError('Auth KO'); return; }
  window.location.href = `${APP_URL}/?token=${encodeURIComponent(session.access_token)}`;
}

async function doSignUp(email, password, password2){
  const plan = selectedPlan() || localStorage.getItem('plan');
  if(!plan){ showError("Choisissez un plan avant l'inscription."); return; }
  if(password.length < 8){ showError("Mot de passe trop court (min. 8 caractères)."); return; }
  if(password !== password2){ showError("Les mots de passe ne correspondent pas."); return; }
  const ent = (document.getElementById('entreprise')?.value || '').trim();

  const { error } = await client.auth.signUp({
    email, password,
    options:{ data:{ plan, entreprise: ent } }
  });
  if(error){ showError('Erreur inscription : '+error.message); return; }

  const { data:{ session } } = await client.auth.getSession();
  if(session){
    await client.auth.updateUser({ data:{ plan, entreprise: ent } });
    window.location.href = `${APP_URL}/?token=${encodeURIComponent(session.access_token)}`;
  }else{
    showOk("Inscription créée. Vérifiez votre email pour activer votre compte.");
  }
}

/* ====== Bind ====== */
document.getElementById('btn-auth').onclick=()=>lock(btnAuth, async()=>{
  clearMsg();
  const email=document.getElementById('email').value.trim();
  const pwd=document.getElementById('password').value;
  const pwd2=pass2.value;
  if(!email || !pwd){ showError('Email et mot de passe requis.'); return; }
  if(!isValidEmail(email)){ showError('Email invalide.'); return; }
  if(mode==='signin') await doSignIn(email,pwd);
  else await doSignUp(email,pwd,pwd2);
});
document.getElementById('btn-logout').onclick=async()=>{ await client.auth.signOut(); showOk('Déconnecté.'); };
</script>
</body>
</html>
